開発メモ
========

2024-04-24
----------

### 設定ファイル操作

* 設計指針
    * 祝日情報(`syukujitsu.csv`)の読み込みは必須のため、CSVパーザが必要。
    * その他に必要な情報も複雑な構造ではないため、全てCSV型式とする。
* 処理概要
    * 共通
        * アクセス先フォルダの決定
            * `AppData\Local\SimpleCalendar\`
            * 実アプリ用とユニットテスト用で実装を切り換える? → 別サービス化
        * 初回起動時の設定ファイルの取り扱い
            * 対象ファイルがユーザーディレクトリに無ければ、アプリ内に保持したファイルをコピーする。
        * 読み出すファイルはユーザーディレクトリ側のファイルとする。
            * 読み出し時にエラーになった場合、アプリ内に保持したファイルにフォールバックする。
                * ステータス情報を設定画面で見れるようにした方がよい?
        * 設定ファイルの種類
            * `syukujitsu.csv`: [「国民の祝日」について (内閣府)](https://www8.cao.go.jp/chosei/shukujitsu/gaiyou.html) から取得したデータ。
                * 以下のURLにアクセスして、アプリ内で情報をアップデートする想定。
                    * https://www8.cao.go.jp/chosei/shukujitsu/syukujitsu.csv
                        * URLはおそらく変わらないはず……。
                    * 自動的に取得して非同期にアップデートしようとすると、非同期処理をいろいろ考えないといけないので、とりあえず明示的に取得するボタンか何かを用意する。
            * `specialdays.csv`: ユーザーが手書きで特別日を登録。(実装をシンプルにするため、年月日の指定を必須とする)
            * `daysofweek.csv`: 各曜日の種別(平日/休日など)を登録。土日が休日でない場合に対応。
    * 設定読み込み
        * ファイルのタイムスタンプをチェックして自動的更新することを考えたが、上と同様非同期処理の問題があるので、明示的に読み込むボタンか何かを用意する。
        * サービスではなくモデルで実装する?
* 変更点
    * 曜日毎のスタイル設定を外部化するのに合わせて、DayTypeを見直し。

2024-04-25
----------

* [C# - GetEncodingなどでshift_jisを指定すると例外が発生する](https://www.curict.com/item/72/72d5fb2.html)
    * なん……だと……!?

2024-04-26
----------

* ModelとViewModelとServiceの設計にあたってのポリシーがよくわからない。識者求む(´･ω･`)

2024-04-27
----------

* スタイルを動的に変更しようとすると実行時例外。
    * StaticResouceで参照すると、スタイルがsealされて以後変更不可になる。DynamicResourceを使えばよいらしい。(未確認)
* ResourceDictionaryを外部ファイル化すると、実行時は問題ないのに、VS2022のXAMLデザイナーでエラー(「XDG0003 リソース 'ResourceDictionaryファイル名' を検索できません。」)が発生する。
    * MainWindow.xamlのみで発生する。CalendarMonthView.xamlでは発生しない。
        * エラーメッセージをよく見ると、CalendarMonthView.xamlのSourceでは絶対パスでファイルを指定している(先頭に「/」を付けている)のに、メッセージではパス名の先頭に「/」が付いていない。
            * Sourceを相対パス指定に変更するとエラー解消。おそらくUserControlでResourceDictionaryを外部化すると同様の問題が発生すると思われる。
* 既存の実装だとマウスオーバー関するトリガーの条件設定がいろいろ複雑化するので、DayLabelにIsDayTypeEmptyを足してMultiTriggerにすることでシンプル化した。
    * 合わせて、DayLabel.DayTypeとDayOfWeekLabel.DayOfWeekをstringからenumに変更。(これでインテリセンスが効くはず)
        * DayOfWeekLabel.DayOfWeek設定時、自動的にContentを設定。(国際化を入れるのが面倒なので、直接日本語文字列を設定)
* マウスホイールの回転に対応。InputBindingがマウスホイールの回転に未対応のため、コードビハインドで直接書く。

以上
